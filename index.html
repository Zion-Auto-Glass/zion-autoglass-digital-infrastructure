<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Zion Auto Glass | Verified Quote</title>

<script async src="https://www.googletagmanager.com/gtag/js?id=AW-870403519"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'AW-870403519');
</script>

<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

<style>
  :root { --primary: #004aad; --red: #e60000; --glass: rgba(255, 255, 255, 0.95); }
  body { 
    font-family: -apple-system, system-ui, sans-serif; margin: 0; padding: 0; color: #333;
    background-image: url('https://m.zionautoglass.com/MainPageClassicChevyTruck.jpg');
    background-size: cover; background-position: center; background-attachment: fixed;
    min-height: 100vh;
  }
  .main-wrapper { display: flex; flex-direction: column; align-items: center; padding: 20px; width: 100%; box-sizing: border-box; }
  .container { width: 100%; max-width: 480px; background: var(--glass); padding: 20px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); margin-bottom: 40px; z-index: 2; position: relative; }
  .info-box { width: 100%; max-width: 480px; background: rgba(0, 0, 0, 0.85); color: white; padding: 25px; border-radius: 12px; text-align: center; border: 1px solid rgba(255,255,255,0.2); z-index: 1; }
  .logo-img { max-width: 260px; width: 100%; display: block; margin: 0 auto 15px; }
  
  input, select { width: 100%; padding: 14px; margin-bottom: 12px; border: 2px solid var(--primary); border-radius: 8px; box-sizing: border-box; font-size: 16px; font-weight: 700; color: #000; }
  label { font-weight: 700; font-size: 0.8rem; text-transform: uppercase; display: block; margin-bottom: 5px; color: var(--primary); }
  .row { display: flex; gap: 10px; } .col { flex: 1; } .hidden { display: none; }
  .options-box { background: #f0f7ff; padding: 15px; border-radius: 8px; border: 1px solid #cce4ff; margin-bottom: 15px; }
  
  .website-field { position: absolute; left: -9999px; } /* HONEYPOT */
  
  button[type="submit"] { width: 100%; background: var(--red); color: white; padding: 18px; border: none; font-size: 1.2rem; font-weight: bold; border-radius: 8px; cursor: pointer; margin-top: 15px; }
  
  @media (min-width: 900px) { .main-wrapper { flex-direction: row; justify-content: center; align-items: flex-start; gap: 40px; padding-top: 50px; } }
</style>
</head>
<body>

<div class="main-wrapper">
  <div class="container">
    <img src="https://m.zionautoglass.com/zionlogo.jpg" alt="Zion Auto Glass" class="logo-img">
    
    <form id="zionForm">
      <input type="hidden" name="gclid" id="gclid">
      <input type="hidden" name="user_ip" id="user_ip">
      <input type="hidden" name="funnel_source" value="Main Website">
      
      <div class="website-field"><label>Website</label><input type="text" id="honey_trap" name="website_url" tabindex="-1" autocomplete="off"></div>
      
      <div class="row">
        <div class="col"><label>First Name</label><input type="text" name="firstName" placeholder="Jane" required></div>
        <div class="col"><label>Last Name</label><input type="text" name="lastName" placeholder="Doe" required></div>
      </div>
      <label>Mobile Phone</label><input type="tel" name="phone" placeholder="(936) 555-0199" required>
      <label>Email Address</label><input type="email" name="email" placeholder="jane@example.com" required>
      <label>Zip Code</label><input type="tel" name="zip" placeholder="75901" maxlength="5" required>

      <hr style="border:0; border-top:1px solid #eee; margin: 15px 0;">

      <div class="row">
        <div class="col"><label>Year</label><select id="year" name="year" required><option value="">Year</option></select></div>
        <div class="col"><label>Make</label>
          <select id="make" name="make" required>
            <option value="">Select Make</option>
            <option value="Ford">Ford</option><option value="Chevrolet">Chevrolet</option><option value="Toyota">Toyota</option><option value="Honda">Honda</option><option value="Dodge">Dodge</option><option value="Nissan">Nissan</option><option value="Jeep">Jeep</option><option value="GMC">GMC</option><option value="Other">Other</option>
          </select>
        </div>
      </div>
      <label>Model</label><select id="model" name="model" disabled required><option>-- Select Year & Make --</option></select>
      <input type="text" id="model-manual" name="model_manual" class="hidden" placeholder="Type Model Name">

      <label>Body Style</label>
      <select name="bodyStyle" required>
        <option value="">-- Select Body Style --</option>
        <option value="Sedan (4 Door)">Sedan (4 Door)</option><option value="Coupe (2 Door)">Coupe (2 Door)</option><option value="SUV">SUV</option><option value="Truck Crew Cab">Truck Crew Cab</option><option value="Truck Ext Cab">Truck Ext Cab</option><option value="Truck Reg Cab">Truck Reg Cab</option>
      </select>

      <label>Service Required</label>
      <select id="glassPart" name="glassPart" required>
        <option value="Windshield">Windshield</option><option value="Back Glass">Back Glass</option><option value="Door Glass">Door Glass</option><option value="Vent/Quarter">Vent/Quarter</option><option value="Sunroof">Sunroof</option><option value="Other">Other</option>
      </select>
      
      <div id="windshieldOptions" class="hidden options-box">
         <label>Service Type</label><select name="ws_service"><option value="Replacement">Replacement</option><option value="Chip Repair">Chip Repair</option></select>
         <div style="margin-top:10px;"><label><input type="checkbox" name="opt_rain"> Rain Sensor</label><label><input type="checkbox" name="opt_lane"> Lane Camera</label></div>
      </div>

      <div class="cf-turnstile" data-sitekey="0x4AAAAAACKSYELy5eRYB9gy" data-theme="light" style="margin-top:15px; margin-bottom: 10px;"></div>

      <button type="submit" id="submitBtn">GET MY QUOTE</button>
      <p style="text-align:center; font-size:0.75rem; color:#888; margin-top:10px;">Secure SSL Submission</p>
    </form>
  </div>
  
  <div class="info-box">
    <h3>Local & Trusted</h3>
    <p>#1 on Google for Auto Glass in Lufkin.</p>
    <p style="font-size:1.2rem; font-weight:bold; color:#4da6ff;">1-936-707-7105</p>
    <p>1500 Atkinson Drive, Lufkin, TX 75901</p>
  </div>
</div>

<script>
  // CONFIG
  const scriptURL = 'https://script.google.com/macros/s/AKfycbzy3anFgwk-7c1UFr9J0Qb8D4h5awGmVlsLjW_uAs0qRfusgJQSqsQllQk0FZtTTR0l/exec';

  // 1. GET IP (Required for Backend VPN Check)
  fetch('https://api.ipify.org?format=json').then(r=>r.json()).then(d=>document.getElementById('user_ip').value=d.ip);

  // 2. LOGIC
  function getParam(n){var r=new RegExp("[\\?&]"+n+"=([^&#]*)").exec(location.search);return r===null?"":decodeURIComponent(r[1].replace(/\+/g," "));}
  document.getElementById('gclid').value = getParam('gclid');

  const ySel=document.getElementById('year'), mInput=document.getElementById('make'), modSel=document.getElementById('model');
  for(let i=2026;i>=1990;i--){let o=document.createElement('option');o.value=i;o.text=i;ySel.add(o);}

  function fetchModels(){
    const y=ySel.value, m=mInput.value;
    modSel.innerHTML='<option>-- Select Year & Make --</option>'; modSel.disabled=true;
    if(y && m && m!=='Other'){
       modSel.innerHTML='<option>Loading...</option>'; modSel.classList.remove('hidden'); document.getElementById('model-manual').classList.add('hidden');
       fetch(`https://vpic.nhtsa.dot.gov/api/vehicles/getmodelsformakeyear/make/${m}/modelyear/${y}?format=json`)
       .then(r=>r.json()).then(d=>{
         if(d.Count===0) throw new Error();
         modSel.innerHTML='<option value="">Select Model</option>'; modSel.disabled=false;
         d.Results.forEach(x=>{let o=document.createElement('option');o.text=x.Model_Name;modSel.add(o);});
       }).catch(()=>{ modSel.classList.add('hidden'); document.getElementById('model-manual').classList.remove('hidden'); });
    } else if(m==='Other'){ modSel.classList.add('hidden'); document.getElementById('model-manual').classList.remove('hidden'); }
  }
  ySel.addEventListener('change', fetchModels); mInput.addEventListener('change', fetchModels);

  // OPTIONS TOGGLE
  document.getElementById('glassPart').addEventListener('change', function() {
    if(this.value === 'Windshield') document.getElementById('windshieldOptions').classList.remove('hidden');
    else document.getElementById('windshieldOptions').classList.add('hidden');
  });

  // 3. SECURE SUBMIT
  document.getElementById('zionForm').onsubmit = (e) => {
    e.preventDefault();
    if(document.getElementById('honey_trap').value !== "") return; // Bot Trap
    
    const btn = document.getElementById('submitBtn');
    btn.innerText = "Securing..."; btn.disabled = true;
    
    let finalModel = modSel.value;
    if(!document.getElementById('model-manual').classList.contains('hidden')) finalModel = document.getElementById('model-manual').value;
    const fd = new FormData(e.target);
    fd.append('final_model', finalModel);

    // Send to Google Script (Which handles the VPN Check now)
    fetch(scriptURL, { method: 'POST', body: fd, mode: 'no-cors' })
    .then(() => { 
        sessionStorage.setItem('zion_submission_valid', 'true');
        window.location.href = 'thankyou.html'; 
    })
    .catch(err => { 
        alert("Connection Error. Please call 1-936-707-7105"); 
        btn.innerText="Try Again"; btn.disabled=false; 
    });
  };
</script>
</body>
</html>
