<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Express Chip Repair | Zion Auto Glass</title>

<script async src="https://www.googletagmanager.com/gtag/js?id=AW-870403519"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'AW-870403519');
</script>
<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

<style>
  /* --- THEME: SPEED & FUNCTION --- */
  :root { 
    --primary: #004aad; 
    --red: #e60000; 
    --green: #28a745; /* Added Green for "Repair" vibe */
    --glass-bg: rgba(255, 255, 255, 0.96); 
    --shadow: 0 15px 40px rgba(0,0,0,0.5);
  }
  
  body { 
    font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    margin: 0; padding: 0; color: #1a1a1a;
    background-image: url('https://m.zionautoglass.com/MainPageClassicChevyTruck.jpg'); 
    background-size: cover; background-position: center; background-attachment: fixed;
    min-height: 100vh;
  }

  .main-wrapper { display: flex; flex-direction: column; align-items: center; padding: 20px; padding-top: 30px; }
  
  /* CONTAINER: Narrow & Tall (Like a receipt/ticket) */
  .container { 
    width: 100%; max-width: 450px; 
    background: var(--glass-bg); 
    padding: 25px; border-radius: 16px; 
    box-shadow: var(--shadow); 
    border-top: 6px solid var(--primary); /* Blue Speed Stripe */
    margin-bottom: 40px; position: relative;
  }
  
  .logo-img { max-width: 240px; width: 100%; display: block; margin: 0 auto 15px; }

  h2.form-header { 
    text-align: center; color: var(--primary); margin: 0 0 20px 0;
    font-size: 1.5rem; font-weight: 900; text-transform: uppercase;
  }

  /* COMPACT INPUTS */
  input, select { 
    width: 100%; padding: 12px; margin-bottom: 12px; 
    border: 2px solid #ddd; border-radius: 8px; font-weight: 700;
  }
  input:focus, select:focus { border-color: var(--primary); outline: none; }
  
  .row { display: flex; gap: 10px; } .col { flex: 1; } .hidden { display: none; }
  
  /* VISUAL DAMAGE SELECTOR */
  .damage-box { 
    background: #f0f8ff; border: 2px dashed var(--primary); 
    padding: 15px; border-radius: 10px; text-align: center; margin-bottom: 15px;
  }
  
  /* PRICE WIDGET (The "Receipt") */
  .price-widget {
      background: #222; color: #0f0; /* Retro Digital Look */
      font-family: 'Courier New', monospace;
      padding: 15px; border-radius: 8px; text-align: center;
      margin: 15px 0; border: 2px solid #555;
      box-shadow: inset 0 0 10px #000;
  }
  .price-amt { font-size: 2rem; font-weight: bold; display: block; }
  .price-lbl { font-size: 0.8rem; opacity: 0.7; text-transform: uppercase; }

  /* BUTTONS */
  button[type="submit"] { 
    width: 100%; background: var(--green); /* Green for GO/Fix */
    color: white; padding: 18px; border: none; 
    font-size: 1.3rem; font-weight: 900; border-radius: 8px; cursor: pointer; 
    text-transform: uppercase; box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
  }
  button:hover { background: #218838; transform: translateY(-2px); }

  /* TOGGLES */
  .toggle-group { display: flex; gap: 5px; margin-bottom: 10px; }
  .toggle-btn { 
    flex: 1; padding: 10px; text-align: center; background: #fff; 
    border: 1px solid #ccc; cursor: pointer; font-weight: bold; border-radius: 6px;
  }
  .toggle-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
  .toggle-btn input { display: none; }

  @media (min-width: 900px) { .main-wrapper { flex-direction: row; justify-content: center; gap: 40px; } }
</style>
</head>
<body>

<div class="main-wrapper">
  <div class="container">
    <img src="https://m.zionautoglass.com/zionlogo.jpg" alt="Zion Auto Glass" class="logo-img">
    <h2 class="form-header">Express Chip Repair</h2>
    
    <form id="zionForm">
      <input type="hidden" name="gclid" id="gclid">
      <input type="hidden" name="user_ip" id="user_ip">
      <input type="hidden" name="glassPart" value="Chip Repair">
      <div style="position:absolute; left:-9999px;"><input type="text" id="honey_trap" name="website_url" tabindex="-1"></div>
      
      <div class="row">
        <div class="col"><input type="text" name="firstName" placeholder="First Name" required></div>
        <div class="col"><input type="text" name="lastName" placeholder="Last Name" required></div>
      </div>
      <input type="tel" name="phone" placeholder="Mobile Phone" required>
      <input type="email" name="email" id="emailInput" placeholder="Email Address" onchange="validateEmail()" required>
      <div id="emailError" class="hidden" style="color:red; font-size:0.8rem; margin-top:-10px;">Fix Email</div>
      
      <div class="damage-box">
          <label style="color:var(--primary); font-weight:800; display:block; margin-bottom:10px;">DAMAGE ASSESSMENT</label>
          <div class="row" style="align-items:center;">
             <div class="col">
                 <span style="font-size:0.85rem; font-weight:bold;">Count:</span>
                 <select id="chip_count" onchange="calcPrice()" style="margin:0;">
                     <option value="1">1 Chip</option><option value="2">2 Chips</option><option value="3">3 Chips</option>
                 </select>
             </div>
             <div class="col">
                 <span style="font-size:0.85rem; font-weight:bold;">Zip:</span>
                 <input type="tel" id="zipInput" name="zip" placeholder="75901" maxlength="5" onchange="handleZip()" style="margin:0;">
             </div>
          </div>
      </div>

      <label style="font-weight:800; font-size:0.8rem; color:#666;">SERVICE LOCATION</label>
      <div class="toggle-group">
          <label class="toggle-btn active" onclick="setLoc('Shop', this)">
              <input type="radio" name="chip_loc" value="Shop" checked> IN-SHOP
          </label>
          <label class="toggle-btn" onclick="setLoc('Mobile', this)">
              <input type="radio" name="chip_loc" value="Mobile"> MOBILE
          </label>
      </div>
      <input type="text" id="mobileAddr" name="service_address" class="hidden" placeholder="Enter Service Address">

      <div class="price-widget">
          <span class="price-amt" id="finalPrice">$60.00</span>
          <span class="price-lbl" id="priceNote">Shop Rate (Tax Inc.)</span>
      </div>

      <div class="row">
         <div class="col"><input type="date" name="book_date" id="bookDate" required></div>
         <div class="col"><select name="book_time"><option>Morning</option><option>Afternoon</option></select></div>
      </div>
      
      <button type="submit" id="submitBtn">BOOK REPAIR NOW</button>
        <p style="text-align:center; font-size:0.75rem; color:#888; margin-top:15px;">
          Secure 256-bit SSL Encrypted Submission <br>
          <a href="privacy.html" target="_blank" style="color:#888; text-decoration:underline;">Privacy Policy</a>
      </p>

    </form>
  </div>
</div>

<script>
  // --- CHIP REPAIR BRAINS ---
  const scriptURL = 'https://script.google.com/macros/s/AKfycbzy3anFgwk-7c1UFr9J0Qb8D4h5awGmVlsLjW_uAs0qRfusgJQSqsQllQk0FZtTTR0l/exec';
  const SHOP_LAT = 31.3386; const SHOP_LON = -94.7291; 
  const FREE_ZIPS = ['75901', '75902', '75903', '75904', '75915', '75949'];
  let dist = 0;

  const today = new Date().toISOString().split('T')[0];
  if(document.getElementById('bookDate')) document.getElementById('bookDate').min = today;

  function validateEmail() {
      const v = document.getElementById('emailInput').value;
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      document.getElementById('emailError').classList.toggle('hidden', re.test(v));
      return re.test(v);
  }

  function setLoc(val, btn) {
      document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active'); btn.querySelector('input').checked = true;
      document.getElementById('mobileAddr').classList.toggle('hidden', val !== 'Mobile');
      calcPrice();
  }

  function handleZip() {
      const z = document.getElementById('zipInput').value;
      if(z.length===5) {
        fetch(`https://api.zippopotam.us/us/${z}`).then(r=>r.json()).then(d=>{
            const lat = parseFloat(d.places[0].latitude); const lon = parseFloat(d.places[0].longitude);
            dist = getDist(SHOP_LAT, SHOP_LON, lat, lon);
            calcPrice();
        });
      }
  }

  function getDist(lat1,lon1,lat2,lon2) {
    var R = 3958.8; var dLat = (lat2-lat1)*(Math.PI/180); var dLon = (lon2-lon1)*(Math.PI/180); 
    var a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(lat1*(Math.PI/180)) * Math.cos(lat2*(Math.PI/180)) * Math.sin(dLon/2) * Math.sin(dLon/2); 
    return R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)));
  }

  function calcPrice() {
      const c = parseInt(document.getElementById('chip_count').value);
      const isMob = document.querySelector('input[name="chip_loc"]:checked').value === 'Mobile';
      const z = document.getElementById('zipInput').value;
      let tot = 60 + ((c-1)*10);
      let note = "Shop Rate (Tax Inc.)";
      
      if(isMob) {
          if(FREE_ZIPS.includes(z)) { note = "Mobile Fee Waived"; }
          else { let m = Math.ceil(dist); if(m<1) m=0; tot+=m; note = `Incl. $${m} Mobile Fee`; }
      }
      document.getElementById('finalPrice').innerText = "$" + tot + ".00";
      document.getElementById('priceNote').innerText = note;
  }

  document.getElementById('zionForm').onsubmit = (e) => {
    e.preventDefault();
    if(document.getElementById('honey_trap').value !== "") return;
    if(!validateEmail()) { alert("Check Email"); return; }
    const btn = document.getElementById('submitBtn'); btn.innerText = "..."; btn.disabled = true;
    const fd = new FormData(e.target);
    
    fetch('https://vpnapi.io/api/?key=ad27e9e886c443d39ea71cd9aed6ea20').then(r=>r.json()).then(d=>{
        if(d.security.vpn) { alert("VPN"); btn.innerText="Retry"; btn.disabled=false; return; }
        fd.set('user_ip', d.ip);
        fetch(scriptURL, { method: 'POST', body: fd, mode: 'no-cors' })
        .then(() => { sessionStorage.setItem('zion_submission_valid', 'true'); window.location.href = 'thankyou.html'; })
        .catch(() => { btn.disabled=false; });
    });
  };
</script>
</body>
</html>
